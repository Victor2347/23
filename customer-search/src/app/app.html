<div class="app-container">
  <!-- è¨Šæ¯æç¤º -->
  @if (message()) {
    <div class="toast" [class.success]="messageType() === 'success'" [class.error]="messageType() === 'error'">
      {{ message() }}
    </div>
  }

  <!-- æ¨™é¡Œå€ -->
  <header class="header">
    <h1>ğŸ” å®¢æˆ¶ä»£ç¢¼æŸ¥è©¢ç³»çµ±</h1>
    <p class="subtitle">è¼¸å…¥åœ°å€æˆ–æ”¶è²¨äººå¿«é€ŸæŸ¥è©¢å®¢æˆ¶ä»£ç¢¼</p>
  </header>

  <!-- æœå°‹å€ -->
  <section class="search-section">
    <div class="search-box">
      <input
        type="text"
        class="search-input"
        placeholder="è¼¸å…¥åœ°å€æˆ–æ”¶è²¨äººåç¨±..."
        [value]="searchQuery()"
        (input)="onSearchInputChange($event)"
        (keyup.enter)="onSearch()"
      />
      <button class="search-btn" (click)="onSearch()" [disabled]="isSearching()">
        @if (isSearching()) {
          <span class="spinner"></span>
        } @else {
          æœå°‹
        }
      </button>
    </div>
  </section>

  <!-- æœå°‹çµæœ -->
  @if (searchResults().length > 0) {
    <section class="results-section">
      <h2>æœå°‹çµæœ ({{ searchResults().length }} ç­†)</h2>
      <div class="results-grid">
        @for (customer of searchResults(); track customer.id) {
          <div class="result-card">
            <div class="customer-code" (click)="copyToClipboard(customer.customer_code)">
              <span class="code-label">å®¢æˆ¶ä»£ç¢¼</span>
              <span class="code-value">{{ customer.customer_code }}</span>
              <span class="copy-hint">é»æ“Šè¤‡è£½</span>
            </div>
            <div class="customer-info">
              <div class="info-row">
                <span class="label">æ”¶è²¨äºº</span>
                <span class="value">{{ customer.recipient }}</span>
              </div>
              <div class="info-row">
                <span class="label">åœ°å€</span>
                <span class="value">{{ customer.address }}</span>
              </div>
              <div class="info-row">
                <span class="label">çµ±ç·¨</span>
                <span class="value">{{ customer.tax_id || '-' }}</span>
              </div>
            </div>
            <button class="delete-btn" (click)="deleteCustomer(customer.id!)">åˆªé™¤</button>
          </div>
        }
      </div>
    </section>
  }

  <!-- åŠŸèƒ½æŒ‰éˆ•å€ -->
  <section class="actions-section">
    <button class="action-btn primary" (click)="toggleAddForm()">
      {{ showAddForm() ? 'å–æ¶ˆ' : '+ æ–°å¢å®¢æˆ¶' }}
    </button>
    
    <label class="action-btn secondary">
      ğŸ“¥ åŒ¯å…¥ Excel/CSV
      <input
        type="file"
        accept=".xlsx,.xls,.csv"
        (change)="onFileChange($event)"
        hidden
      />
    </label>

    <button class="action-btn outline" (click)="toggleAllCustomers()">
      {{ showAllCustomers() ? 'éš±è—åˆ—è¡¨' : 'é¡¯ç¤ºæ‰€æœ‰å®¢æˆ¶' }}
    </button>
  </section>

  <!-- æ–°å¢è¡¨å–® -->
  @if (showAddForm()) {
    <section class="add-form-section">
      <h2>æ–°å¢å®¢æˆ¶</h2>
      <form class="add-form" (submit)="$event.preventDefault(); addCustomer()">
        <div class="form-group">
          <label for="customer_code">å®¢æˆ¶ä»£ç¢¼ *</label>
          <input
            id="customer_code"
            type="text"
            [value]="newCustomer().customer_code"
            (input)="updateNewCustomer('customer_code', $event)"
            required
          />
        </div>
        <div class="form-group">
          <label for="recipient">æ”¶è²¨äºº *</label>
          <input
            id="recipient"
            type="text"
            [value]="newCustomer().recipient"
            (input)="updateNewCustomer('recipient', $event)"
            required
          />
        </div>
        <div class="form-group">
          <label for="address">åœ°å€ *</label>
          <input
            id="address"
            type="text"
            [value]="newCustomer().address"
            (input)="updateNewCustomer('address', $event)"
            required
          />
        </div>
        <div class="form-group">
          <label for="tax_id">çµ±ç·¨</label>
          <input
            id="tax_id"
            type="text"
            [value]="newCustomer().tax_id"
            (input)="updateNewCustomer('tax_id', $event)"
          />
        </div>
        <button type="submit" class="submit-btn">ç¢ºèªæ–°å¢</button>
      </form>
    </section>
  }

  <!-- æ‰€æœ‰å®¢æˆ¶åˆ—è¡¨ -->
  @if (showAllCustomers()) {
    <section class="all-customers-section">
      <h2>æ‰€æœ‰å®¢æˆ¶ ({{ allCustomers().length }} ç­†)</h2>
      @if (allCustomers().length === 0) {
        <p class="empty-state">å°šç„¡å®¢æˆ¶è³‡æ–™</p>
      } @else {
        <div class="table-container">
          <table class="customers-table">
            <thead>
              <tr>
                <th>å®¢æˆ¶ä»£ç¢¼</th>
                <th>æ”¶è²¨äºº</th>
                <th>åœ°å€</th>
                <th>çµ±ç·¨</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              @for (customer of allCustomers(); track customer.id) {
                <tr>
                  <td class="code-cell" (click)="copyToClipboard(customer.customer_code)">
                    {{ customer.customer_code }}
                  </td>
                  <td>{{ customer.recipient }}</td>
                  <td>{{ customer.address }}</td>
                  <td>{{ customer.tax_id || '-' }}</td>
                  <td>
                    <button class="table-delete-btn" (click)="deleteCustomer(customer.id!)">
                      åˆªé™¤
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </section>
  }

  <!-- ä½¿ç”¨èªªæ˜ -->
  <section class="help-section">
    <h3>ğŸ“‹ Excel/CSV åŒ¯å…¥æ ¼å¼</h3>
    <p>è«‹ç¢ºä¿æ¬„ä½åç¨±ç‚ºï¼š<code>å®¢æˆ¶ä»£ç¢¼</code>ã€<code>æ”¶è²¨äºº</code>ã€<code>åœ°å€</code>ã€<code>çµ±ç·¨</code></p>
    <p>æˆ–è‹±æ–‡ï¼š<code>customer_code</code>ã€<code>recipient</code>ã€<code>address</code>ã€<code>tax_id</code></p>
  </section>
</div>
